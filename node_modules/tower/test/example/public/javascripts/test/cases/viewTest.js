var store, user, view;

view = null;

user = null;

store = Tower.View.store();

describe("Tower.View", function() {
  var engine, _i, _len, _ref, _results;
  beforeEach(function() {
    Tower.View.engine = "coffee";
    return view = new Tower.View;
  });
  afterEach(function() {
    return Tower.View.engine = "coffee";
  });
  describe('path to files', function() {
    test('loadPaths', function() {
      return assert.deepEqual(store.loadPaths, ["" + Tower.relativeRoot + "/app/views"]);
    });
    test("findPath(path: 'custom/engine', ext: 'coffee')", function() {
      var path;
      path = store.findPath({
        path: 'custom/engine',
        ext: 'coffee'
      });
      assert.equal(path, "" + Tower.relativeRoot + "/app/views/custom/engine.coffee");
      path = store.findPath({
        path: 'custom2/engine',
        ext: 'coffee'
      });
      return assert.equal(path, "" + Tower.relativeRoot + "/app/views/custom2/engine.coffee");
    });
    return test("findPath(path: 'engine', ext: 'coffee', prefixes: ['custom'])", function() {
      var path;
      path = store.findPath({
        path: 'engine',
        ext: 'coffee',
        prefixes: ['custom']
      });
      assert.equal(path, "" + Tower.relativeRoot + "/app/views/custom/engine.coffee");
      path = store.findPath({
        path: 'engine',
        ext: 'coffee',
        prefixes: ['custom2']
      });
      return assert.equal(path, "" + Tower.relativeRoot + "/app/views/custom2/engine.coffee");
    });
  });
  describe('config', function() {
    test('setting default engine', function(done) {
      var engine;
      Tower.View.engine = 'jade';
      engine = 'jade';
      return view.render({
        template: 'custom/engine',
        locals: {
          ENGINE: engine
        }
      }, function(error, body) {
        assert.equal(body.trim(), "<h1>I'm jade!</h1>");
        return done();
      });
    });
    return test('specifying custom type different from default engine', function(done) {
      var engine;
      Tower.View.engine = 'jade';
      engine = 'coffee';
      return view.render({
        template: 'custom/engine',
        type: engine,
        locals: {
          ENGINE: engine
        }
      }, function(error, body) {
        assert.equal(body.trim(), "<h1>I'm coffee!</h1>");
        return done();
      });
    });
  });
  _ref = ['coffee', 'jade', 'ejs', 'eco', 'mustache'];
  _results = [];
  for (_i = 0, _len = _ref.length; _i < _len; _i++) {
    engine = _ref[_i];
    _results.push((function(engine) {
      describe("render view with " + engine, function() {
        test("findPath(path: 'engine', ext: '" + engine + "', prefixes: ['custom'])", function() {
          var path;
          path = store.findPath({
            path: 'engine',
            ext: engine,
            prefixes: ['custom']
          });
          return assert.equal(path, "" + Tower.relativeRoot + "/app/views/custom/engine." + engine);
        });
        test("render(template: 'custom/engine." + engine + "')", function(done) {
          return view.render({
            template: "custom/engine." + engine,
            locals: {
              ENGINE: engine
            }
          }, function(error, body) {
            assert.equal(body.trim(), "<h1>I'm " + engine + "!</h1>");
            return done();
          });
        });
        test("render(template: 'custom/engine', type: '" + engine + "')", function(done) {
          return view.render({
            template: 'custom/engine',
            type: engine,
            locals: {
              ENGINE: engine
            }
          }, function(error, body) {
            assert.equal(body.trim(), "<h1>I'm " + engine + "!</h1>");
            return done();
          });
        });
        test("render(template: 'engine', type: '" + engine + "', prefixes: ['custom'])", function(done) {
          return view.render({
            template: 'engine',
            type: engine,
            prefixes: ['custom'],
            locals: {
              ENGINE: engine
            }
          }, function(error, body) {
            assert.equal(body.trim(), "<h1>I'm " + engine + "!</h1>");
            return done();
          });
        });
        return test("render(template: 'custom/engine', type: '" + engine + "', layout: 'test')", function(done) {
          return view.render({
            template: 'custom/engine',
            type: engine,
            layout: 'test',
            locals: {
              ENGINE: engine
            }
          }, function(error, body) {
            assert.equal(body.trim(), "<h1>I'm " + engine + "!</h1>");
            return done();
          });
        });
      });
      return describe("Tower.View.engine = '" + engine + "' (default engine)", function() {
        beforeEach(function() {
          return Tower.View.engine = engine;
        });
        afterEach(function() {
          return Tower.View.engine = "coffee";
        });
        return test("render(template: 'custom/engine')", function(done) {
          return view.render({
            template: 'custom/engine',
            locals: {
              ENGINE: engine
            }
          }, function(error, body) {
            assert.equal(body.trim(), "<h1>I'm " + engine + "!</h1>");
            return done();
          });
        });
      });
    })(engine));
  }
  return _results;
});
